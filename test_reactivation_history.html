<!DOCTYPE html>
<html>
<head>
    <title>Teste - Hist√≥rico de Reativa√ß√£o</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>üîç Teste do Hist√≥rico de Reativa√ß√£o</h1>
    
    <div id="results"></div>
    
    <script>
        // Configura√ß√£o do Supabase (substitua pelas suas credenciais)
        const SUPABASE_URL = 'https://your-project.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';
        
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        async function testReactivationHistory() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>üîÑ Testando...</p>';
            
            try {
                console.log('üîç Testando acesso direto √† tabela...');
                
                // 1. Teste direto na tabela
                const { data: directData, error: directError } = await supabase
                    .from('reactivated_leads')
                    .select('*')
                    .limit(5);
                
                console.log('üìä Dados diretos:', directData);
                console.log('‚ùå Erro direto:', directError);
                
                // 2. Teste da fun√ß√£o RPC
                console.log('üîç Testando fun√ß√£o RPC...');
                const { data: rpcData, error: rpcError } = await supabase
                    .rpc('get_reactivated_leads_history', {
                        p_page: 1,
                        p_limit: 10,
                        p_sdr: null,
                        p_status: null
                    });
                
                console.log('üìä Dados RPC:', rpcData);
                console.log('‚ùå Erro RPC:', rpcError);
                
                // 3. Verificar usu√°rio atual
                const { data: user, error: userError } = await supabase.auth.getUser();
                console.log('üë§ Usu√°rio:', user);
                console.log('‚ùå Erro usu√°rio:', userError);
                
                // Mostrar resultados na tela
                resultsDiv.innerHTML = `
                    <h2>üìä Resultados do Teste:</h2>
                    
                    <h3>1. Acesso Direto √† Tabela:</h3>
                    <pre>Dados: ${JSON.stringify(directData, null, 2)}</pre>
                    <pre>Erro: ${JSON.stringify(directError, null, 2)}</pre>
                    
                    <h3>2. Fun√ß√£o RPC:</h3>
                    <pre>Dados: ${JSON.stringify(rpcData, null, 2)}</pre>
                    <pre>Erro: ${JSON.stringify(rpcError, null, 2)}</pre>
                    
                    <h3>3. Usu√°rio Atual:</h3>
                    <pre>Usu√°rio: ${JSON.stringify(user, null, 2)}</pre>
                    <pre>Erro: ${JSON.stringify(userError, null, 2)}</pre>
                `;
                
            } catch (error) {
                console.error('üí• Erro geral:', error);
                resultsDiv.innerHTML = `<p>üí• Erro: ${error.message}</p>`;
            }
        }
        
        // Executar teste automaticamente
        testReactivationHistory();
    </script>
</body>
</html>

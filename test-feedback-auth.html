<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Autentica√ß√£o - Feedback GGV</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            font-weight: 500;
        }
        .success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .info { background: #dbeafe; color: #1d4ed8; border: 1px solid #bfdbfe; }
        .warning { background: #fef3c7; color: #d97706; border: 1px solid #fed7aa; }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 4px;
        }
        button:hover { background: #1d4ed8; }
        .clear { background: #dc2626; }
        .clear:hover { background: #b91c1c; }
        pre {
            background: #f1f5f9;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Teste de Autentica√ß√£o - Sistema de Feedback</h1>
        <p>Esta p√°gina testa o sistema de autentica√ß√£o para acesso direto ao feedback.</p>

        <div id="status"></div>

        <h3>A√ß√µes de Teste:</h3>
        <button onclick="checkAuthStatus()">Verificar Status de Auth</button>
        <button onclick="simulateLogin()">Simular Login</button>
        <button onclick="testFeedbackAccess()">Testar Acesso ao Feedback</button>
        <button onclick="clearStorage()" class="clear">Limpar Storage</button>

        <h3>URLs de Teste:</h3>
        <div>
            <button onclick="openFeedbackPage()">Abrir P√°gina de Feedback</button>
            <button onclick="openFeedbackWithDeal()">Feedback com Deal ID</button>
        </div>

        <h3>Logs do Sistema:</h3>
        <pre id="logs"></pre>
    </div>

    <script>
        let logs = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${message}`);
            document.getElementById('logs').textContent = logs.join('\n');
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }

        function checkAuthStatus() {
            log('üîç Verificando status de autentica√ß√£o...');
            
            const localUser = localStorage.getItem('ggv-user');
            const localTimestamp = localStorage.getItem('ggv-user-timestamp');
            const sessionUser = sessionStorage.getItem('ggv-user');
            const sessionTimestamp = sessionStorage.getItem('ggv-user-timestamp');

            if (localUser && localTimestamp) {
                const user = JSON.parse(localUser);
                const timestamp = parseInt(localTimestamp);
                const now = Date.now();
                const age = Math.floor((now - timestamp) / (1000 * 60)); // minutos

                log(`‚úÖ Usu√°rio encontrado no localStorage: ${user.email}`);
                log(`‚è∞ Idade da sess√£o: ${age} minutos`);
                
                showStatus(`Usu√°rio logado: ${user.email} (${age} min atr√°s)`, 'success');
            } else {
                log('‚ùå Nenhum usu√°rio encontrado no storage');
                showStatus('Nenhum usu√°rio logado', 'error');
            }

            log(`üìä Storage status:`);
            log(`  - localStorage: ${localUser ? 'SIM' : 'N√ÉO'}`);
            log(`  - sessionStorage: ${sessionUser ? 'SIM' : 'N√ÉO'}`);
        }

        function simulateLogin() {
            log('üîÑ Simulando login...');
            
            const mockUser = {
                id: 'test-user-id',
                email: 'test@ggvinteligencia.com.br',
                name: 'Usu√°rio Teste',
                initials: 'UT',
                role: 'User'
            };

            const userJson = JSON.stringify(mockUser);
            const timestamp = Date.now().toString();

            localStorage.setItem('ggv-user', userJson);
            localStorage.setItem('ggv-user-timestamp', timestamp);
            sessionStorage.setItem('ggv-user', userJson);
            sessionStorage.setItem('ggv-user-timestamp', timestamp);

            log(`‚úÖ Login simulado para: ${mockUser.email}`);
            showStatus(`Login simulado: ${mockUser.email}`, 'success');
        }

        function testFeedbackAccess() {
            log('üß™ Testando acesso ao feedback...');
            
            const localUser = localStorage.getItem('ggv-user');
            const localTimestamp = localStorage.getItem('ggv-user-timestamp');

            if (!localUser || !localTimestamp) {
                log('‚ùå Usu√°rio n√£o est√° logado');
                showStatus('Erro: Usu√°rio n√£o est√° logado', 'error');
                return;
            }

            const user = JSON.parse(localUser);
            const timestamp = parseInt(localTimestamp);
            const now = Date.now();
            const oneHour = 60 * 60 * 1000;
            const oneDay = 24 * 60 * 60 * 1000;

            // Simular verifica√ß√£o para p√°gina de feedback
            const sessionDuration = oneDay; // 24h para feedback
            const isValid = (now - timestamp) < sessionDuration;

            if (isValid) {
                log('‚úÖ Acesso ao feedback autorizado');
                showStatus('Acesso autorizado para p√°gina de feedback', 'success');
            } else {
                log('‚ùå Sess√£o expirada para feedback');
                showStatus('Sess√£o expirada (mais de 24h)', 'warning');
            }

            const ageHours = Math.floor((now - timestamp) / (1000 * 60 * 60));
            log(`‚è∞ Idade da sess√£o: ${ageHours} horas`);
        }

        function clearStorage() {
            log('üßπ Limpando storage...');
            
            localStorage.removeItem('ggv-user');
            localStorage.removeItem('ggv-user-timestamp');
            sessionStorage.removeItem('ggv-user');
            sessionStorage.removeItem('ggv-user-timestamp');

            log('‚úÖ Storage limpo');
            showStatus('Storage limpo', 'info');
        }

        function openFeedbackPage() {
            const url = 'https://app.grupoggv.com/feedback/';
            log(`üîó Abrindo: ${url}`);
            window.open(url, '_blank');
        }

        function openFeedbackWithDeal() {
            const url = 'https://app.grupoggv.com/feedback/?deal_id=62719';
            log(`üîó Abrindo: ${url}`);
            window.open(url, '_blank');
        }

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ P√°gina de teste carregada');
            checkAuthStatus();
        });
    </script>
</body>
</html>

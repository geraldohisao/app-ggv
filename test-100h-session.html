<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Sess√£o 100h - GGV</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            font-weight: 500;
        }
        .success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .info { background: #dbeafe; color: #1d4ed8; border: 1px solid #bfdbfe; }
        .warning { background: #fef3c7; color: #d97706; border: 1px solid #fed7aa; }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 4px;
            font-size: 14px;
        }
        button:hover { background: #1d4ed8; }
        .clear { background: #dc2626; }
        .clear:hover { background: #b91c1c; }
        .simulate { background: #059669; }
        .simulate:hover { background: #047857; }
        pre {
            background: #f1f5f9;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }
        .card {
            background: #f8fafc;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .card h4 {
            margin: 0 0 8px 0;
            color: #334155;
        }
        .value {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚è∞ Teste de Sess√£o 100 Horas - Sistema GGV</h1>
        <p>Teste do novo sistema de persist√™ncia de sess√£o por 100 horas desde o √∫ltimo acesso.</p>

        <div id="status"></div>

        <div class="grid">
            <div class="card">
                <h4>Status da Sess√£o</h4>
                <div id="session-status" class="value">Verificando...</div>
            </div>
            <div class="card">
                <h4>Usu√°rio Logado</h4>
                <div id="user-info" class="value">-</div>
            </div>
            <div class="card">
                <h4>Idade da Sess√£o</h4>
                <div id="session-age" class="value">-</div>
            </div>
            <div class="card">
                <h4>Tempo Restante</h4>
                <div id="time-remaining" class="value">-</div>
            </div>
        </div>

        <h3>A√ß√µes de Teste:</h3>
        <div>
            <button onclick="checkSession()">üîç Verificar Sess√£o</button>
            <button onclick="simulateLogin()" class="simulate">üë§ Simular Login</button>
            <button onclick="simulateActivity()" class="simulate">‚ö° Simular Atividade</button>
            <button onclick="testOldSession()" class="warning">‚è∞ Testar Sess√£o Antiga</button>
            <button onclick="clearStorage()" class="clear">üóëÔ∏è Limpar Storage</button>
        </div>

        <h3>Testes de Tempo:</h3>
        <div>
            <button onclick="simulate1HourAgo()">1 hora atr√°s</button>
            <button onclick="simulate24HoursAgo()">24 horas atr√°s</button>
            <button onclick="simulate99HoursAgo()">99 horas atr√°s</button>
            <button onclick="simulate101HoursAgo()">101 horas atr√°s (expirado)</button>
        </div>

        <h3>Logs do Sistema:</h3>
        <pre id="logs"></pre>
    </div>

    <script>
        let logs = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logs.push(`[${timestamp}] ${message}`);
            document.getElementById('logs').textContent = logs.join('\n');
            document.getElementById('logs').scrollTop = document.getElementById('logs').scrollHeight;
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }

        function updateSessionInfo() {
            const localUser = localStorage.getItem('ggv-user');
            const localTimestamp = localStorage.getItem('ggv-user-timestamp');
            
            if (!localUser || !localTimestamp) {
                document.getElementById('session-status').textContent = 'N√£o logado';
                document.getElementById('user-info').textContent = '-';
                document.getElementById('session-age').textContent = '-';
                document.getElementById('time-remaining').textContent = '-';
                return;
            }

            const user = JSON.parse(localUser);
            const timestamp = parseInt(localTimestamp);
            const now = Date.now();
            const ageMs = now - timestamp;
            const ageHours = Math.floor(ageMs / (1000 * 60 * 60));
            const ageMinutes = Math.floor((ageMs % (1000 * 60 * 60)) / (1000 * 60));
            
            const oneHundredHours = 100 * 60 * 60 * 1000;
            const isValid = ageMs < oneHundredHours;
            const remainingMs = oneHundredHours - ageMs;
            const remainingHours = Math.floor(remainingMs / (1000 * 60 * 60));

            document.getElementById('session-status').textContent = isValid ? '‚úÖ V√°lida' : '‚ùå Expirada';
            document.getElementById('user-info').textContent = user.email || user.name;
            document.getElementById('session-age').textContent = `${ageHours}h ${ageMinutes}min`;
            document.getElementById('time-remaining').textContent = isValid ? `${remainingHours}h` : '0h';
        }

        function checkSession() {
            log('üîç Verificando status da sess√£o...');
            
            const localUser = localStorage.getItem('ggv-user');
            const localTimestamp = localStorage.getItem('ggv-user-timestamp');

            if (localUser && localTimestamp) {
                const user = JSON.parse(localUser);
                const timestamp = parseInt(localTimestamp);
                const now = Date.now();
                const ageMs = now - timestamp;
                const ageHours = Math.floor(ageMs / (1000 * 60 * 60));
                
                const oneHundredHours = 100 * 60 * 60 * 1000;
                const isValid = ageMs < oneHundredHours;

                log(`‚úÖ Usu√°rio: ${user.email}`);
                log(`‚è∞ Idade: ${ageHours} horas`);
                log(`üìä Status: ${isValid ? 'V√ÅLIDA' : 'EXPIRADA'}`);
                
                showStatus(`Sess√£o ${isValid ? 'v√°lida' : 'expirada'} - ${user.email} (${ageHours}h)`, 
                          isValid ? 'success' : 'error');
            } else {
                log('‚ùå Nenhuma sess√£o encontrada');
                showStatus('Nenhuma sess√£o ativa', 'error');
            }
            
            updateSessionInfo();
        }

        function simulateLogin() {
            log('üîÑ Simulando login...');
            
            const mockUser = {
                id: 'test-user-' + Date.now(),
                email: 'teste@ggvinteligencia.com.br',
                name: 'Usu√°rio Teste',
                initials: 'UT',
                role: 'User'
            };

            const userJson = JSON.stringify(mockUser);
            const timestamp = Date.now().toString();

            localStorage.setItem('ggv-user', userJson);
            localStorage.setItem('ggv-user-timestamp', timestamp);
            sessionStorage.setItem('ggv-user', userJson);
            sessionStorage.setItem('ggv-user-timestamp', timestamp);

            log(`‚úÖ Login simulado: ${mockUser.email}`);
            showStatus(`Login realizado: ${mockUser.email}`, 'success');
            updateSessionInfo();
        }

        function simulateActivity() {
            log('‚ö° Simulando atividade do usu√°rio...');
            
            const localUser = localStorage.getItem('ggv-user');
            if (!localUser) {
                log('‚ùå Usu√°rio n√£o est√° logado');
                showStatus('Erro: Usu√°rio n√£o est√° logado', 'error');
                return;
            }

            // Renovar timestamp (simular atividade)
            const newTimestamp = Date.now().toString();
            localStorage.setItem('ggv-user-timestamp', newTimestamp);
            sessionStorage.setItem('ggv-user-timestamp', newTimestamp);

            log('üîÑ Timestamp renovado por atividade');
            showStatus('Sess√£o renovada por atividade', 'success');
            updateSessionInfo();
        }

        function testOldSession() {
            log('‚è∞ Testando sess√£o antiga...');
            
            const localUser = localStorage.getItem('ggv-user');
            if (!localUser) {
                simulateLogin();
            }

            // Simular sess√£o de 50 horas atr√°s
            const fiftyHoursAgo = Date.now() - (50 * 60 * 60 * 1000);
            localStorage.setItem('ggv-user-timestamp', fiftyHoursAgo.toString());
            sessionStorage.setItem('ggv-user-timestamp', fiftyHoursAgo.toString());

            log('‚è∞ Sess√£o alterada para 50 horas atr√°s');
            showStatus('Sess√£o alterada para 50 horas atr√°s', 'warning');
            updateSessionInfo();
        }

        function simulate1HourAgo() {
            const oneHourAgo = Date.now() - (1 * 60 * 60 * 1000);
            setSessionTime(oneHourAgo, '1 hora atr√°s');
        }

        function simulate24HoursAgo() {
            const twentyFourHoursAgo = Date.now() - (24 * 60 * 60 * 1000);
            setSessionTime(twentyFourHoursAgo, '24 horas atr√°s');
        }

        function simulate99HoursAgo() {
            const ninetyNineHoursAgo = Date.now() - (99 * 60 * 60 * 1000);
            setSessionTime(ninetyNineHoursAgo, '99 horas atr√°s');
        }

        function simulate101HoursAgo() {
            const oneHundredOneHoursAgo = Date.now() - (101 * 60 * 60 * 1000);
            setSessionTime(oneHundredOneHoursAgo, '101 horas atr√°s');
        }

        function setSessionTime(timestamp, description) {
            const localUser = localStorage.getItem('ggv-user');
            if (!localUser) {
                simulateLogin();
            }
            
            localStorage.setItem('ggv-user-timestamp', timestamp.toString());
            sessionStorage.setItem('ggv-user-timestamp', timestamp.toString());
            
            log(`‚è∞ Sess√£o alterada para: ${description}`);
            updateSessionInfo();
        }

        function clearStorage() {
            log('üßπ Limpando storage...');
            
            localStorage.removeItem('ggv-user');
            localStorage.removeItem('ggv-user-timestamp');
            sessionStorage.removeItem('ggv-user');
            sessionStorage.removeItem('ggv-user-timestamp');

            log('‚úÖ Storage limpo');
            showStatus('Storage limpo', 'info');
            updateSessionInfo();
        }

        // Atualizar informa√ß√µes a cada 5 segundos
        setInterval(updateSessionInfo, 5000);

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ P√°gina de teste de sess√£o 100h carregada');
            checkSession();
        });
    </script>
</body>
</html>
